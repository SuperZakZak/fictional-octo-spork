# Поддержка форматов изображений

## Обзор

Сайт теперь поддерживает современные форматы изображений с автоматическим fallback:

### Поддерживаемые форматы (в порядке приоритета):
1. **AVIF** - Самый современный и эффективный формат (лучшее сжатие)
2. **WebP** - Хорошее сжатие с широкой поддержкой браузеров
3. **PNG** - Универсальный формат-fallback

## Как это работает

### Автоматический Fallback
Система автоматически пробует загрузить изображения в следующем порядке:
1. Сначала пытается загрузить `.avif`
2. Если не удалось - пробует `.webp`
3. Если и это не удалось - загружает `.png`

### Пример структуры файлов:
```
/public/images/products/
├── tshirt/
│   ├── black.avif    (приоритет 1)
│   ├── black.webp    (приоритет 2)
│   ├── black.png     (приоритет 3)
│   └── ...
├── hoodie/
│   └── ...
└── tote/
    └── ...
```

## Конфигурация

### Next.js Config (`next.config.js`)
```javascript
images: {
  formats: ['image/avif', 'image/webp'],
  // Next.js автоматически оптимизирует изображения
}
```

### Upload Config (`src/lib/constants.ts`)
```typescript
export const UPLOAD_CONFIG = {
  acceptedFormats: [".png", ".jpg", ".jpeg", ".svg", ".webp", ".avif"],
  acceptedMimeTypes: ["image/png", "image/jpeg", "image/svg+xml", "image/webp", "image/avif"],
  // ...
}
```

## Преимущества

### AVIF формат:
- ✅ До 50% меньше размер файла по сравнению с JPEG
- ✅ До 30% меньше размер файла по сравнению с WebP
- ✅ Поддержка HDR и широкой цветовой гаммы
- ✅ Лучшее качество при том же размере файла

### WebP формат:
- ✅ До 30% меньше размер файла по сравнению с JPEG/PNG
- ✅ Широкая поддержка браузеров (>95%)
- ✅ Поддержка прозрачности и анимации

## Рекомендации

### Для продакшена:
1. Конвертируйте все изображения в AVIF для лучшей производительности
2. Держите WebP версии как fallback
3. Оставьте PNG только для совместимости

### Инструменты для конвертации:
```bash
# Конвертация PNG в AVIF
npx @squoosh/cli --avif '{"cqLevel":33,"speed":6}' input.png

# Конвертация PNG в WebP
npx @squoosh/cli --webp '{"quality":80}' input.png

# Или используйте онлайн инструменты:
# - https://squoosh.app/
# - https://cloudconvert.com/
```

## Поддержка браузеров

| Формат | Chrome | Firefox | Safari | Edge |
|--------|--------|---------|--------|------|
| AVIF   | 85+    | 93+     | 16.1+  | 85+  |
| WebP   | 23+    | 65+     | 14+    | 18+  |
| PNG    | ✅     | ✅      | ✅     | ✅   |

## Тестирование

Чтобы проверить работу fallback:
1. Удалите `.avif` файл для определенного цвета
2. Откройте консоль браузера
3. Выберите этот цвет в интерфейсе
4. Вы увидите сообщение: "Trying next format: webp"

## Производительность

### Сравнение размеров (пример для изображения 1920x1080):
- PNG: ~775 KB
- WebP: ~200 KB (74% экономии)
- AVIF: ~120 KB (85% экономии)

### Влияние на загрузку:
- Быстрее загрузка страницы
- Меньше трафика
- Лучше SEO (Core Web Vitals)
